# 컴포넌트 스캔

- [컴포넌트 스캔](#컴포넌트-스캔)
  - [컴포넌트 스캔의 필요성](#컴포넌트-스캔의-필요성)
  - [컴포넌트 스캔 사용법](#컴포넌트-스캔-사용법)
    - [컴포넌트 스캔 탐색 위치를](#컴포넌트-스캔-탐색-위치를)
    - [Controller, Service, Repository](#controller-service-repository)
    - [자동 의존 관계 주입 주의점](#자동-의존-관계-주입-주의점)

## 컴포넌트 스캔의 필요성

스프링 컨테이너는 `@Configuration` 어노테이션이 붙어 있는 스프링 설정 파일에서 `@Bean` 어노테이션을 통해 객체를 스프링 빈에 등록하고 관리한다.

등록할 빈의 개수가 적으면 크게 문제가 되지 않지만, 프로그램이 커질수록 관리할 빈의 개수가 많아지고, 개발자의 입장에서 등록의 귀찮음과 누락의 문제가 발생할 수 있다.

따라서 스프링에서는 설정 정보 없이 자동으로 스프링 빈을 등록해주는데, 이를 컴포넌트 스캔이라고 한다.

또한 컴포넌트 스캔 간 의존관계 자동 주입을 위한 `@Autowired` 어노테이션도 제공한다.

## 컴포넌트 스캔 사용법

기본적으로 방법은 다음과 같다.

- `@Configuration` 어노테이션이 붙은 스프링 설정 파일에 `@ComponentScan` 어노테이션을 추가한다.
- 스프링 빈으로 등록할 클래스에 `@Component` 어노테이션을 추가한다.
- 스프링 설정 파일의 `@ComponentScan` 어노테이션 속성으로 등록할 클래스의 위치를 제공한다.

위와 같이 설정할 경우, `@ComponentScan`에 제공된 속성대로 `@Component` 어노테이션이 붙은 모든 클래스를 스프링 빈에 등록한다.

이때 특징으로 스프링 빈의 이름을 클래스명의 맨 앞을 소문자로 사용한 것으로 설정한다. (예를 들면 `MyBean` 클래스의 경우 `myBean`으로 등록된다.)

또한 `@Autowired` 어노테이션을 통해 의존관계를 자동으로 주입해준다.

### 컴포넌트 스캔 탐색 위치를

- `basePackages` 옵션은 해당 입력한 위치(패키지) 부터 찾기 시작해서 그 하위 패키지까지 검사하며 컴포넌트를 검색한다.
- `includeFilters`와 `excludeFilters` 옵션을 통해 포함할 타입과 포함하지 않을 타입을 지정할 수 있다. 필터 타입 옵션은 다음과 같다.
  - FilterType.ANNOTATION: 기본값으로, 어노테이션을 의미한다.
  - FilterType.ASSIGNABLE_TYPE: 지정된 타입과 자식 타입을 의미한다.
  - FilterType.ASPECTJ: AspectJ 패턴 타입을 의미한다.
  - FilterType.REGEX: 정규 표현식 타입을 의미한다.
  - FilterType.CUSTOM: `TypeFilter` 인터페이스를 구현한 커스텀 타입을 의미한다.
- `basePackagesClass` 옵션을 지정하는 경우 해당 입력한 클래스의 패키지를 시작 위치로 그 하위 패키지까지 검사하며 컴포넌트를 검색한다.

### Controller, Service, Repository

`@Controller`, `@Service`, `@Repository` 어노테이션은 실제 코드를 보면 내부에 `@Component` 어노테이션과 함께 구현되어 있다.

즉 따로 `@Component` 어노테이션을 추가하지 않아도 기본적으로 컴포넌트 스캔의 대상으로 적용된다.

`useDefaultFilters` 옵션을 통해 기본 대상을 제외할 수 있다.

### 자동 의존 관계 주입 주의점

컴포넌트 스캔 시 `@Autowired`는 앞서 설명한 것 처럼 클래스 명을 기반으로 자동으로 스프링 빈을 등록한다.

만약 **자동 의존 관계 주입으로 동일한 스프링 빈 이름이 중복하여 등록**되면 어떤 일이 발생할까?

`ConflictingBeanDefinitionException`이라는 예외가 발생한다.

그러나 **수동 의존 관계 주입과 자동 의존 관계 주입을 동시에 사용**할 경우는 다른 결과가 발생한다.

- 이 경우 수동으로 등록된 빈이 우선된다.
- 예외는 발생하지 않지만 로그로 빈이 오버라디드 됨을 알려준다.
- 최신 스프링 부트에서는 이를 예외로 처리하여 예외를 발생시킨다.
