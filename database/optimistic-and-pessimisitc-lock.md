# 비관적 락과 낙관적 락

- [비관적 락과 낙관적 락](#비관적-락과-낙관적-락)
  - [비관적 락 (Optimistic Lock)](#비관적-락-optimistic-lock)
    - [장점](#장점)
    - [단점](#단점)
  - [낙관적 락 (Pessimistic Lock)](#낙관적-락-pessimistic-lock)
    - [장점](#장점-1)
    - [단점](#단점-1)
  - [결론](#결론)
  - [래퍼런스](#래퍼런스)

## 비관적 락 (Optimistic Lock)

`비관적`이라는 단어 처럼, 데이터베이스 자원에 대한 **동시성 문제가 발생한다고 가정**하고 락을 거는 방법이다.

- 트랜잭션 동시성 문제가 발생한다고 가정하므로 어떤 트랜잭션이 자원을 사용하고 있다면 다른 트랜잭션이 접근하지 못하도록 막는다.
- **데이터베이스에서 거는 락**으로 공유 락(Shared Lock) 또는 배타적 락(Exclusive Lock)을 건다.
  - 공유 락: 다른 트랜잭션에서 **읽기**만 가능. (중첩하여 공유 락 적용이 가능하지만 배타적 락은 추가할 수 없다.)
  - 배타적 락: 다른 트랜잭션에서 **읽기, 쓰기** 불가능. (배타적 락이 걸려있는 경우 다른 락을 걸 수 없다.)
- **롤백: 비관적 락은 충돌 발생 시 트랜잭션이 실패한 것으로 판단하고 자동으로 롤백이 진행된다.**

### 장점

- 트랜잭션 동시성 문제가 많이 발생하는 환경에서 롤백 횟수를 줄일 수 있다.
- 데이터 무결성 보장 수준이 놆다.

### 단점

- 결국 데이터베이스 상 락이 걸리므로 동시성이 떨어진다.
- 읽기가 많이 일어나는 환경에서 손해가 크다.
- 데드락 가능성이 있다.

## 낙관적 락 (Pessimistic Lock)

`낙관적`이라는 단어 처럼, 데이터베이스 자원에 대한 동시성 문제가 발생하지 않는다고 가정하고, 만약 **동시성 문제가 발생하면 그때 처리**하는 방법이다.

- 트랜잭션 동시성 문제가 발생하지 않을 것이라고 가정하고, 만약 충돌이 확인되면 롤백을 진행한다.
- **어플리케이션**에서 동시성을 처리한다.
- **롤백: 충돌이 발생하여 수정되지 않은 부분은 어플리케이션에서 수동으로 롤백할 필요가 있다.**

### 장점

- 충돌이 발생하지 않으면 동시성이 극대화된다.

### 단점

- 동시성 문제가 많이 발생하는 환경에서 충돌에 대한 롤백 처리에 대한 비용이 많이 든다.
- 복잡한 롤백 처리 구현이 어렵다.

## 결론

위와 같은 장단점을 잘 살피고 환경에 맞는 필요한 락을 선택하여 사용하자.

또한 JPA에서도 락을 설정할 수 있는 내용이 있는데, 후에 관련 내용을 추가로 포스팅 할 예정이다.

## 래퍼런스

https://sabarada.tistory.com/175

https://unluckyjung.github.io/db/2022/03/07/Optimistic-vs-Pessimistic-Lock/
